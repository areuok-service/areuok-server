#!/bin/bash
# Pre-commit hook for Rust project
# This script runs basic checks before committing

set -e

echo "ğŸ” Running pre-commit checks..."

# Format check
echo "ğŸ“ Checking code format..."
if ! cargo fmt --all -- --check; then
    echo "âŒ Code formatting issues found!"
    echo "   Run 'cargo fmt --all' to fix."
    exit 1
fi

# Clippy
echo "ğŸ” Running Clippy lints..."
if ! cargo clippy --workspace --all-targets -- -D warnings; then
    echo "âŒ Clippy found issues!"
    echo "   Please fix them before committing."
    exit 1
fi

# Tests (if DATABASE_URL is set)
if [ -n "$DATABASE_URL" ]; then
    echo "ğŸ§ª Running tests..."
    if ! cargo test --workspace; then
        echo "âŒ Tests failed!"
        echo "   Please fix failing tests before committing."
        exit 1
    fi
else
    echo "â­ï¸  Skipping tests (DATABASE_URL not set)"
fi

echo "âœ… All checks passed!"
